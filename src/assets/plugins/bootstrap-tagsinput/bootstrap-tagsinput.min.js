(function(e){var a={tagClass:function(i){return"label label-info"},itemValue:function(i){return i?i.toString():i},itemText:function(i){return this.itemValue(i)},freeInput:true,maxTags:undefined,confirmKeys:[13],onTagExists:function(j,i){i.hide().fadeIn()},trimValue:false};function d(j,i){this.itemsArray=[];this.$element=e(j);this.$element.hide();this.isSelect=(j.tagName==="SELECT");this.multiple=(this.isSelect&&j.hasAttribute("multiple"));this.objectItems=i&&i.itemValue;this.placeholderText=j.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=e('<div class="bootstrap-tagsinput"></div>');this.$input=e('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$element.after(this.$container);this.$input.get(0).style.setProperty("width",this.inputSize<3?3:this.inputSize+"em","important");this.build(i)}d.prototype={constructor:d,add:function(t,q){var u=this;if(u.options.maxTags&&u.itemsArray.length>=u.options.maxTags){return}if(t!==false&&!t){return}if(typeof t==="string"&&u.options.trimValue){t=e.trim(t)}if(typeof t==="object"&&!u.objectItems){throw ("Can't add objects when itemValue option is not set")}if(t.toString().match(/^\s*$/)){return}if(u.isSelect&&!u.multiple&&u.itemsArray.length>0){u.remove(u.itemsArray[0])}if(typeof t==="string"&&this.$element[0].tagName==="INPUT"){var r=t.split(",");if(r.length>1){for(var o=0;o<r.length;o++){this.add(r[o],true)}if(!q){u.pushVal()}return}}var l=u.options.itemValue(t),s=u.options.itemText(t),n=u.options.tagClass(t);var k=e.grep(u.itemsArray,function(i){return u.options.itemValue(i)===l})[0];if(k){if(u.options.onTagExists){var m=e(".tag",u.$container).filter(function(){return e(this).data("item")===k});u.options.onTagExists(t,m)}return}if(u.items().toString().length+t.length+1>u.options.maxInputLength){return}u.itemsArray.push(t);var p=e('<span class="tag '+f(n)+'">'+f(s)+'<span data-role="remove"></span></span>');p.data("item",t);u.findInputWrapper().before(p);p.after(" ");if(u.isSelect&&!e('option[value="'+encodeURIComponent(l)+'"]',u.$element)[0]){var j=e("<option selected>"+f(s)+"</option>");j.data("item",t);j.attr("value",l);u.$element.append(j)}if(!q){u.pushVal()}if(u.options.maxTags===u.itemsArray.length||u.items().toString().length===u.options.maxInputLength){u.$container.addClass("bootstrap-tagsinput-max")}u.$element.trigger(e.Event("itemAdded",{item:t}))},remove:function(j,k){var i=this;if(i.objectItems){if(typeof j==="object"){j=e.grep(i.itemsArray,function(l){return i.options.itemValue(l)==i.options.itemValue(j)})[0]}else{j=e.grep(i.itemsArray,function(l){return i.options.itemValue(l)==j})[0]}}if(j){e(".tag",i.$container).filter(function(){return e(this).data("item")===j}).remove();e("option",i.$element).filter(function(){return e(this).data("item")===j}).remove();i.itemsArray.splice(e.inArray(j,i.itemsArray),1)}if(!k){i.pushVal()}if(i.options.maxTags>i.itemsArray.length){i.$container.removeClass("bootstrap-tagsinput-max")}i.$element.trigger(e.Event("itemRemoved",{item:j}))},removeAll:function(){var i=this;e(".tag",i.$container).remove();e("option",i.$element).remove();while(i.itemsArray.length>0){i.itemsArray.pop()}i.pushVal()},refresh:function(){var i=this;e(".tag",i.$container).each(function(){var k=e(this),m=k.data("item"),n=i.options.itemValue(m),j=i.options.itemText(m),o=i.options.tagClass(m);k.attr("class",null);k.addClass("tag "+f(o));k.contents().filter(function(){return this.nodeType==3})[0].nodeValue=f(j);if(i.isSelect){var l=e("option",i.$element).filter(function(){return e(this).data("item")===m});l.attr("value",n)}})},items:function(){return this.itemsArray},pushVal:function(){var i=this,j=e.map(i.items(),function(k){return i.options.itemValue(k).toString()});i.$element.val(j,true).trigger("change")},build:function(j){var i=this;i.options=e.extend({},a,j);var k=i.options.typeahead||{};if(i.objectItems){i.options.freeInput=false}c(i.options,"itemValue");c(i.options,"itemText");c(i.options,"tagClass");if(i.options.source){k.source=i.options.source}if(k.source&&e.fn.typeahead){g(k,"source");i.$input.typeahead({source:function(n,p){function l(q){var s=[];for(var r=0;r<q.length;r++){var t=i.options.itemText(q[r]);o[t]=q[r];s.push(t)}p(s)}this.map={};var o=this.map,m=k.source(n);if(e.isFunction(m.success)){m.success(l)}else{e.when(m).then(l)}},updater:function(l){i.add(this.map[l])},matcher:function(l){return(l.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1)},sorter:function(l){return l.sort()},highlighter:function(m){var l=new RegExp("("+this.query+")","gi");return m.replace(l,"<strong>$1</strong>")}})}i.$container.on("click",e.proxy(function(l){if(!i.$element.attr("disabled")){i.$input.removeAttr("disabled")}i.$input.focus()},i));i.$input.on("focusout",e.proxy(function(l){i.add(i.$input.val());i.$input.val("")},i));i.$container.on("keydown","input",e.proxy(function(q){var r=e(q.target),n=i.findInputWrapper();if(i.$element.attr("disabled")){i.$input.attr("disabled","disabled");return}switch(q.which){case 8:if(h(r[0])===0){var p=n.prev();if(p){i.remove(p.data("item"))}}break;case 46:if(h(r[0])===0){var m=n.next();if(m){i.remove(m.data("item"))}}break;case 37:var l=n.prev();if(r.val().length===0&&l[0]){l.before(n);r.focus()}break;case 39:var o=n.next();if(r.val().length===0&&o[0]){o.after(n);r.focus()}break;default:if(i.options.freeInput&&e.inArray(q.which,i.options.confirmKeys)>=0){i.add(r.val());r.val("");q.preventDefault()}}r.get(0).style.setProperty("width",Math.max(this.inputSize<3?3:this.inputSize,r.val().length)+"em","important")},i));i.$container.on("click","[data-role=remove]",e.proxy(function(l){if(i.$element.attr("disabled")){return}i.remove(e(l.target).closest(".tag").data("item"))},i));if(i.options.itemValue===a.itemValue){if(i.$element[0].tagName==="INPUT"){i.add(i.$element.val())}else{e("option",i.$element).each(function(){i.add(e(this).attr("value"),true)})}}},destroy:function(){var i=this;i.$container.off("keypress","input");i.$container.off("click","[role=remove]");i.$container.remove();i.$element.removeData("tagsinput");i.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var j=this.$input[0],i=this.$container[0];while(j&&j.parentNode!==i){j=j.parentNode}return e(j)}};e.fn.tagsinput=function(j,i){var k=[];this.each(function(){var m=e(this).data("tagsinput");if(!m){m=new d(this,j);e(this).data("tagsinput",m);k.push(m);if(this.tagName==="SELECT"){e("option",e(this)).attr("selected","selected")}e(this).val(e(this).val())}else{if(!j&&!i){k.push(m)}else{if(m[j]!==undefined){var l=m[j](i);if(l!==undefined){k.push(l)}}}}});if(typeof j=="string"){return k.length>1?k:k[0]}else{return k}};e.fn.tagsinput.Constructor=d;function c(j,k){if(typeof j[k]!=="function"){var i=j[k];j[k]=function(l){return l[i]}}}function g(i,j){if(typeof i[j]!=="function"){var k=i[j];i[j]=function(){return k}}}var b=e("<div />");function f(i){if(i){return b.text(i).html()}else{return""}}function h(j){var k=0;if(document.selection){j.focus();var i=document.selection.createRange();i.moveStart("character",-j.value.length);k=i.text.length}else{if(j.selectionStart||j.selectionStart=="0"){k=j.selectionStart}}return(k)}e(function(){e("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);